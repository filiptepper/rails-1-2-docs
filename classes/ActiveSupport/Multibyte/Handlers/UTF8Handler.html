<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ActiveSupport::Multibyte::Handlers::UTF8Handler</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../../css/github.css" type="text/css" media="screen" />
<script src="../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Class</span> 
            ActiveSupport::Multibyte::Handlers::UTF8Handler 
            
                <span class="parent">&lt; 
                    
                    <a href="../../../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../../files/rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler_rb.html">rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p><a href="UTF8Handler.html">UTF8Handler</a> implements Unicode aware
operations for strings, these operations will be used by the <a
href="../Chars.html">Chars</a> proxy when $KCODE is set to 'UTF8'.</p>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>#</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-5B-5D">[]</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-capitalize">capitalize</a>,
              </li>
            
              
              <li>
                <a href="#method-c-compose">compose</a>,
              </li>
            
              
              <li>
                <a href="#method-c-compose_codepoints">compose_codepoints</a>,
              </li>
            
              
              <li>
                <a href="#method-c-consumes-3F">consumes?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-decompose">decompose</a>,
              </li>
            
              
              <li>
                <a href="#method-c-decompose_codepoints">decompose_codepoints</a>,
              </li>
            
              
              <li>
                <a href="#method-c-downcase">downcase</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>G</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-g_length">g_length</a>,
              </li>
            
              
              <li>
                <a href="#method-c-g_pack">g_pack</a>,
              </li>
            
              
              <li>
                <a href="#method-c-g_unpack">g_unpack</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-in_char_class-3F">in_char_class?</a>,
              </li>
            
              
              <li>
                <a href="#method-c-index">index</a>,
              </li>
            
              
              <li>
                <a href="#method-c-insert">insert</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-length">length</a>,
              </li>
            
              
              <li>
                <a href="#method-c-lstrip">lstrip</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-normalize">normalize</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-reorder_characters">reorder_characters</a>,
              </li>
            
              
              <li>
                <a href="#method-c-reverse">reverse</a>,
              </li>
            
              
              <li>
                <a href="#method-c-rstrip">rstrip</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-size">size</a>,
              </li>
            
              
              <li>
                <a href="#method-c-slice">slice</a>,
              </li>
            
              
              <li>
                <a href="#method-c-strip">strip</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-tidy_bytes">tidy_bytes</a>,
              </li>
            
              
              <li>
                <a href="#method-c-to_case">to_case</a>,
              </li>
            
              
              <li>
                <a href="#method-c-translate_offset">translate_offset</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>U</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-u_unpack">u_unpack</a>,
              </li>
            
              
              <li>
                <a href="#method-c-upcase">upcase</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <div class="sectiontitle">Constants</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">HANGUL_SBASE</td>
            <td>=</td>
            <td class="attr-value">0xAC00</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Hangul character boundaries and properties</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">HANGUL_LBASE</td>
            <td>=</td>
            <td class="attr-value">0x1100</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">HANGUL_VBASE</td>
            <td>=</td>
            <td class="attr-value">0x1161</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">HANGUL_TBASE</td>
            <td>=</td>
            <td class="attr-value">0x11A7</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">HANGUL_LCOUNT</td>
            <td>=</td>
            <td class="attr-value">19</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">HANGUL_VCOUNT</td>
            <td>=</td>
            <td class="attr-value">21</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">HANGUL_TCOUNT</td>
            <td>=</td>
            <td class="attr-value">28</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">HANGUL_NCOUNT</td>
            <td>=</td>
            <td class="attr-value">HANGUL_VCOUNT * HANGUL_TCOUNT</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">HANGUL_SCOUNT</td>
            <td>=</td>
            <td class="attr-value">11172</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">HANGUL_SLAST</td>
            <td>=</td>
            <td class="attr-value">HANGUL_SBASE + HANGUL_SCOUNT</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">HANGUL_JAMO_FIRST</td>
            <td>=</td>
            <td class="attr-value">0x1100</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">HANGUL_JAMO_LAST</td>
            <td>=</td>
            <td class="attr-value">0x11FF</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">UNICODE_WHITESPACE</td>
            <td>=</td>
            <td class="attr-value">[
(0x0009..0x000D).to_a,  # White_Space # Cc   [5] &lt;control-0009&gt;..&lt;control-000D&gt;
0x0020,          # White_Space # Zs       SPACE
0x0085,          # White_Space # Cc       &lt;control-0085&gt;
0x00A0,          # White_Space # Zs       NO-BREAK SPACE
0x1680,          # White_Space # Zs       OGHAM SPACE MARK
0x180E,          # White_Space # Zs       MONGOLIAN VOWEL SEPARATOR
(0x2000..0x200A).to_a, # White_Space # Zs  [11] EN QUAD..HAIR SPACE
0x2028,          # White_Space # Zl       LINE SEPARATOR
0x2029,          # White_Space # Zp       PARAGRAPH SEPARATOR
0x202F,          # White_Space # Zs       NARROW NO-BREAK SPACE
0x205F,          # White_Space # Zs       MEDIUM MATHEMATICAL SPACE
0x3000,          # White_Space # Zs       IDEOGRAPHIC SPACE
].flatten.freeze</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>All the unicode whitespace</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">UNICODE_LEADERS_AND_TRAILERS</td>
            <td>=</td>
            <td class="attr-value">UNICODE_WHITESPACE + [65279]</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>BOM (byte order mark) can also be seen as whitespace, it’s a non-rendering
character used to distinguish between little and big endian. This is not an
issue in utf-8, so it must be ignored.</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">UTF8_PAT</td>
            <td>=</td>
            <td class="attr-value">/\A(?:
[\x00-\x7f]                                     |
[\xc2-\xdf] [\x80-\xbf]                         |
\xe0        [\xa0-\xbf] [\x80-\xbf]             |
[\xe1-\xef] [\x80-\xbf] [\x80-\xbf]             |
\xf0        [\x90-\xbf] [\x80-\xbf] [\x80-\xbf] |
[\xf1-\xf3] [\x80-\xbf] [\x80-\xbf] [\x80-\xbf] |
\xf4        [\x80-\x8f] [\x80-\xbf] [\x80-\xbf]
)*\z/xn</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Borrowed from the Kconv library by Shinji KONO - (also as seen on the W3C
site)</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">UNICODE_TRAILERS_PAT</td>
            <td>=</td>
            <td class="attr-value">/(#{codepoints_to_pattern(UNICODE_LEADERS_AND_TRAILERS)})+\Z/</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">UNICODE_LEADERS_PAT</td>
            <td>=</td>
            <td class="attr-value">/\A(#{codepoints_to_pattern(UNICODE_LEADERS_AND_TRAILERS)})+/</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">UCD</td>
            <td>=</td>
            <td class="attr-value">UnicodeDatabase.new</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>UniCode Database</p></td>
            </tr>
          
        
      </table>
    


    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-5B-5D">
            
              <a name="method-c-5B-5D"></a><b>[]</b>(str, *args)
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-capitalize">
            
              <a name="method-c-capitalize"></a><b>capitalize</b>(str)
            
          </div>
          
          
            <div class="description">
              <p>Returns a copy of <code>str</code> with the first character converted to
uppercase and the remainder to lowercase</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-capitalize_source')" id="l_method-c-capitalize_source">show</a>
                
              </p>
              <div id="method-c-capitalize_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 192</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">capitalize</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-identifier">upcase</span>(<span class="ruby-identifier">slice</span>(<span class="ruby-identifier">str</span>, <span class="ruby-number">0</span><span class="ruby-operator">..</span><span class="ruby-number">0</span>)) <span class="ruby-operator">+</span> <span class="ruby-identifier">downcase</span>(<span class="ruby-identifier">slice</span>(<span class="ruby-identifier">str</span>, <span class="ruby-number">1</span><span class="ruby-operator">..</span><span class="ruby-number">-1</span>) <span class="ruby-operator">||</span> <span class="ruby-string">''</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-compose">
            
              <a name="method-c-compose"></a><b>compose</b>(str)
            
          </div>
          
          
            <div class="description">
              <p>Perform composition on the characters in the string</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-compose_source')" id="l_method-c-compose_source">show</a>
                
              </p>
              <div id="method-c-compose_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 228</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">compose</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-identifier">compose_codepoints</span> <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">pack</span>(<span class="ruby-string">'U*'</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-consumes-3F">
            
              <a name="method-c-consumes-3F"></a><b>consumes?</b>(str)
            
          </div>
          
          
            <div class="description">
              <p>Checks if the string is valid UTF8.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-consumes-3F_source')" id="l_method-c-consumes-3F_source">show</a>
                
              </p>
              <div id="method-c-consumes-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 258</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">consumes?</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-comment"># Unpack is a little bit faster than regular expressions</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">str</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-string">'U*'</span>)
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ArgumentError</span>
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-decompose">
            
              <a name="method-c-decompose"></a><b>decompose</b>(str)
            
          </div>
          
          
            <div class="description">
              <p>Perform decomposition on the characters in the string</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-decompose_source')" id="l_method-c-decompose_source">show</a>
                
              </p>
              <div id="method-c-decompose_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 223</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">decompose</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-identifier">decompose_codepoints</span>(<span class="ruby-value">:canonical</span>, <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>)).<span class="ruby-identifier">pack</span>(<span class="ruby-string">'U*'</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-downcase">
            
              <a name="method-c-downcase"></a><b>downcase</b>(str)
            
          </div>
          
          
            <div class="description">
              <p>Convert characters in the string to lowercase</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-downcase_source')" id="l_method-c-downcase_source">show</a>
                
              </p>
              <div id="method-c-downcase_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 189</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">downcase</span>(<span class="ruby-identifier">str</span>); <span class="ruby-identifier">to_case</span> <span class="ruby-value">:lowercase_mapping</span>, <span class="ruby-identifier">str</span>; <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-g_length">
            
              <a name="method-c-g_length"></a><b>g_length</b>(str)
            
          </div>
          
          
            <div class="description">
              <p>Returns the number of grapheme clusters in the string. This method is very
likely to be moved or renamed in future versions.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-g_length_source')" id="l_method-c-g_length_source">show</a>
                
              </p>
              <div id="method-c-g_length_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 270</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">g_length</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-identifier">g_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">length</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-index">
            
              <a name="method-c-index"></a><b>index</b>(str, *args)
            
          </div>
          
          
            <div class="description">
              <p>Returns the position of the passed argument in the string, counting in
codepoints</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-index_source')" id="l_method-c-index_source">show</a>
                
              </p>
              <div id="method-c-index_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 138</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">index</span>(<span class="ruby-identifier">str</span>, *<span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">bidx</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">index</span>(*<span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">bidx</span> <span class="ruby-operator">?</span> (<span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-number">0</span><span class="ruby-operator">...</span><span class="ruby-identifier">bidx</span>)).<span class="ruby-identifier">size</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-insert">
            
              <a name="method-c-insert"></a><b>insert</b>(str, offset, fragment)
            
          </div>
          
          
            <div class="description">
              <p>Inserts the passed string at specified codepoint offsets</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-insert_source')" id="l_method-c-insert_source">show</a>
                
              </p>
              <div id="method-c-insert_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 128</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">insert</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">offset</span>, <span class="ruby-identifier">fragment</span>)
  <span class="ruby-identifier">str</span>.<span class="ruby-identifier">replace</span>(
    <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">insert</span>(
      <span class="ruby-identifier">offset</span>,
      <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">fragment</span>)
    ).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-string">'U*'</span>)
  )
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-length">
            
              <a name="method-c-length"></a><b>length</b>(str)
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-lstrip">
            
              <a name="method-c-lstrip"></a><b>lstrip</b>(str)
            
          </div>
          
          
            <div class="description">
              <p>Does Unicode-aware lstrip</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-lstrip_source')" id="l_method-c-lstrip_source">show</a>
                
              </p>
              <div id="method-c-lstrip_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 149</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">lstrip</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">UNICODE_LEADERS_PAT</span>, <span class="ruby-string">''</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-normalize">
            
              <a name="method-c-normalize"></a><b>normalize</b>(str, form=ActiveSupport::Multibyte::DEFAULT_NORMALIZATION_FORM)
            
          </div>
          
          
            <div class="description">
              <p>Returns the KC normalization of the string by default. NFKC is considered
the best normalization form for passing strings to databases and
validations.</p>
<ul><li>
<p><code>str</code>: The string to perform normalization on.</p>
</li><li>
<p><code>form</code>: The form you want to normalize in. Should be one of the
following: :c, :kc, :d or :kd.</p>
</li></ul>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-normalize_source')" id="l_method-c-normalize_source">show</a>
                
              </p>
              <div id="method-c-normalize_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 205</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">normalize</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">form</span>=<span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Multibyte</span><span class="ruby-operator">::</span><span class="ruby-constant">DEFAULT_NORMALIZATION_FORM</span>)
  <span class="ruby-comment"># See http://www.unicode.org/reports/tr15, Table 1</span>
  <span class="ruby-identifier">codepoints</span> = <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">form</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:d</span>
      <span class="ruby-identifier">reorder_characters</span>(<span class="ruby-identifier">decompose_codepoints</span>(<span class="ruby-value">:canonical</span>, <span class="ruby-identifier">codepoints</span>))
    <span class="ruby-keyword">when</span> <span class="ruby-value">:c</span>
      <span class="ruby-identifier">compose_codepoints</span> <span class="ruby-identifier">reorder_characters</span>(<span class="ruby-identifier">decompose_codepoints</span>(<span class="ruby-value">:canonical</span>, <span class="ruby-identifier">codepoints</span>))
    <span class="ruby-keyword">when</span> <span class="ruby-value">:kd</span>
      <span class="ruby-identifier">reorder_characters</span>(<span class="ruby-identifier">decompose_codepoints</span>(<span class="ruby-value">:compatability</span>, <span class="ruby-identifier">codepoints</span>))
    <span class="ruby-keyword">when</span> <span class="ruby-value">:kc</span>
      <span class="ruby-identifier">compose_codepoints</span> <span class="ruby-identifier">reorder_characters</span>(<span class="ruby-identifier">decompose_codepoints</span>(<span class="ruby-value">:compatability</span>, <span class="ruby-identifier">codepoints</span>))
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;#{form} is not a valid normalization variant&quot;</span>, <span class="ruby-identifier">caller</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-string">'U*'</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-reverse">
            
              <a name="method-c-reverse"></a><b>reverse</b>(str)
            
          </div>
          
          
            <div class="description">
              <p>Reverses codepoints in the string.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-reverse_source')" id="l_method-c-reverse_source">show</a>
                
              </p>
              <div id="method-c-reverse_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 165</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">reverse</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-string">'U*'</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-rstrip">
            
              <a name="method-c-rstrip"></a><b>rstrip</b>(str)
            
          </div>
          
          
            <div class="description">
              <p>Does Unicode-aware rstrip</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-rstrip_source')" id="l_method-c-rstrip_source">show</a>
                
              </p>
              <div id="method-c-rstrip_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 144</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">rstrip</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">UNICODE_TRAILERS_PAT</span>, <span class="ruby-string">''</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-size">
            
              <a name="method-c-size"></a><b>size</b>(str)
            
          </div>
          
          
            <div class="description">
              <p>Returns the number of codepoints in the string</p>
            </div>
          
          
          
            <div class="aka">
              Also aliased as: <a href="UTF8Handler.html#method-c-length">length</a>
            </div>
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-size_source')" id="l_method-c-size_source">show</a>
                
              </p>
              <div id="method-c-size_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 159</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">size</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">size</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-slice">
            
              <a name="method-c-slice"></a><b>slice</b>(str, *args)
            
          </div>
          
          
            <div class="description">
              <p>Implements Unicode-aware slice with codepoints. Slicing on one point
returns the codepoints for that character.</p>
            </div>
          
          
          
            <div class="aka">
              Also aliased as: <a href="UTF8Handler.html#method-c-5B-5D">[]</a>
            </div>
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-slice_source')" id="l_method-c-slice_source">show</a>
                
              </p>
              <div id="method-c-slice_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 171</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">slice</span>(<span class="ruby-identifier">str</span>, *<span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-number">2</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Range</span>))
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-string">'cannot convert Range into Integer'</span> <span class="ruby-comment"># Do as if we were native</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">args</span>[<span class="ruby-number">0</span>].<span class="ruby-identifier">kind_of?</span> <span class="ruby-constant">Range</span>
    <span class="ruby-identifier">cps</span> = <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">slice</span>(*<span class="ruby-identifier">args</span>)
    <span class="ruby-identifier">cps</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">cps</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-string">'U*'</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-number">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">args</span>[<span class="ruby-number">0</span>].<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Numeric</span>)
    <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>)[<span class="ruby-identifier">args</span>[<span class="ruby-number">0</span>]]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">slice</span>(*<span class="ruby-identifier">args</span>).<span class="ruby-identifier">pack</span>(<span class="ruby-string">'U*'</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-strip">
            
              <a name="method-c-strip"></a><b>strip</b>(str)
            
          </div>
          
          
            <div class="description">
              <p>Removed leading and trailing whitespace</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-strip_source')" id="l_method-c-strip_source">show</a>
                
              </p>
              <div id="method-c-strip_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 154</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">strip</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">UNICODE_LEADERS_PAT</span>, <span class="ruby-string">''</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">UNICODE_TRAILERS_PAT</span>, <span class="ruby-string">''</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-tidy_bytes">
            
              <a name="method-c-tidy_bytes"></a><b>tidy_bytes</b>(str)
            
          </div>
          
          
            <div class="description">
              <p>Replaces all the non-utf-8 bytes by their iso-8859-1 or cp1252 equivalent
resulting in a valid utf-8 string</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-tidy_bytes_source')" id="l_method-c-tidy_bytes_source">show</a>
                
              </p>
              <div id="method-c-tidy_bytes_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 275</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">tidy_bytes</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-identifier">str</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">%r/</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">UTF8_PAT</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">c</span>)
      <span class="ruby-identifier">n</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-string">'C'</span>)[<span class="ruby-number">0</span>]
      <span class="ruby-identifier">n</span> <span class="ruby-operator">&lt;</span> <span class="ruby-number">128</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">chr</span> <span class="ruby-operator">:</span>
      <span class="ruby-identifier">n</span> <span class="ruby-operator">&lt;</span> <span class="ruby-number">160</span> <span class="ruby-operator">?</span> [<span class="ruby-constant">UCD</span>.<span class="ruby-identifier">cp1252</span>[<span class="ruby-identifier">n</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">n</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-string">'U'</span>) <span class="ruby-operator">:</span>
      <span class="ruby-identifier">n</span> <span class="ruby-operator">&lt;</span> <span class="ruby-number">192</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;\xC2&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">chr</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;\xC3&quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">n</span><span class="ruby-operator">-</span><span class="ruby-number">64</span>).<span class="ruby-identifier">chr</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">c</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">join</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-translate_offset">
            
              <a name="method-c-translate_offset"></a><b>translate_offset</b>(str, byte_offset)
            
          </div>
          
          
            <div class="description">
              <p>Used to translate an offset from bytes to characters, for instance one
received from a regular expression match</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-translate_offset_source')" id="l_method-c-translate_offset_source">show</a>
                
              </p>
              <div id="method-c-translate_offset_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 237</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">translate_offset</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">byte_offset</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-number">0</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">str</span> <span class="ruby-operator">==</span> <span class="ruby-string">''</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">byte_offset</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">chunk</span> = <span class="ruby-identifier">str</span>[<span class="ruby-number">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">byte_offset</span>]
  <span class="ruby-keyword">begin</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">chunk</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-string">'U*'</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-number">1</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ArgumentError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
      <span class="ruby-identifier">chunk</span> = <span class="ruby-identifier">str</span>[<span class="ruby-number">0</span><span class="ruby-operator">..</span>(<span class="ruby-identifier">byte_offset</span><span class="ruby-operator">+=</span><span class="ruby-number">1</span>)]
      <span class="ruby-comment"># Stop retrying at the end of the string</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-identifier">e</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">byte_offset</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">chunk</span>.<span class="ruby-identifier">length</span> 
      <span class="ruby-comment"># We damaged a character, retry</span>
      <span class="ruby-keyword">retry</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Catch the ArgumentError so we can throw our own</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ArgumentError</span> 
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncodingError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">'malformed UTF-8 character'</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-upcase">
            
              <a name="method-c-upcase"></a><b>upcase</b>(str)
            
          </div>
          
          
            <div class="description">
              <p>Convert characters in the string to uppercase</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-upcase_source')" id="l_method-c-upcase_source">show</a>
                
              </p>
              <div id="method-c-upcase_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 186</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">upcase</span>(<span class="ruby-identifier">str</span>); <span class="ruby-identifier">to_case</span> <span class="ruby-value">:uppercase_mapping</span>, <span class="ruby-identifier">str</span>; <span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
              
      <div class="sectiontitle">Class Protected methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-compose_codepoints">
            
              <a name="method-c-compose_codepoints"></a><b>compose_codepoints</b>(codepoints)
            
          </div>
          
          
            <div class="description">
              <p>Compose decomposed characters to the composed form</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-compose_codepoints_source')" id="l_method-c-compose_codepoints_source">show</a>
                
              </p>
              <div id="method-c-compose_codepoints_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 392</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">compose_codepoints</span>(<span class="ruby-identifier">codepoints</span>)
  <span class="ruby-identifier">pos</span> = <span class="ruby-number">0</span>
  <span class="ruby-identifier">eoa</span> = <span class="ruby-identifier">codepoints</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-number">1</span>
  <span class="ruby-identifier">starter_pos</span> = <span class="ruby-number">0</span>
  <span class="ruby-identifier">starter_char</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-number">0</span>]
  <span class="ruby-identifier">previous_combining_class</span> = <span class="ruby-number">-1</span>
  <span class="ruby-keyword">while</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">eoa</span>
    <span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-number">1</span>
    <span class="ruby-identifier">lindex</span> = <span class="ruby-identifier">starter_char</span> <span class="ruby-operator">-</span> <span class="ruby-constant">HANGUL_LBASE</span>
    <span class="ruby-comment"># -- Hangul</span>
    <span class="ruby-keyword">if</span> <span class="ruby-number">0</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">lindex</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">lindex</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">HANGUL_LCOUNT</span>
      <span class="ruby-identifier">vindex</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">starter_pos</span><span class="ruby-operator">+</span><span class="ruby-number">1</span>] <span class="ruby-operator">-</span> <span class="ruby-constant">HANGUL_VBASE</span> <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">vindex</span> = <span class="ruby-number">-1</span>
      <span class="ruby-keyword">if</span> <span class="ruby-number">0</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">vindex</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">vindex</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">HANGUL_VCOUNT</span>
        <span class="ruby-identifier">tindex</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">starter_pos</span><span class="ruby-operator">+</span><span class="ruby-number">2</span>] <span class="ruby-operator">-</span> <span class="ruby-constant">HANGUL_TBASE</span> <span class="ruby-keyword">rescue</span> <span class="ruby-identifier">tindex</span> = <span class="ruby-number">-1</span>
        <span class="ruby-keyword">if</span> <span class="ruby-number">0</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">tindex</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">tindex</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">HANGUL_TCOUNT</span>
          <span class="ruby-identifier">j</span> = <span class="ruby-identifier">starter_pos</span> <span class="ruby-operator">+</span> <span class="ruby-number">2</span>
          <span class="ruby-identifier">eoa</span> <span class="ruby-operator">-=</span> <span class="ruby-number">2</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">tindex</span> = <span class="ruby-number">0</span>
          <span class="ruby-identifier">j</span> = <span class="ruby-identifier">starter_pos</span> <span class="ruby-operator">+</span> <span class="ruby-number">1</span>
          <span class="ruby-identifier">eoa</span> <span class="ruby-operator">-=</span> <span class="ruby-number">1</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">starter_pos</span><span class="ruby-operator">..</span><span class="ruby-identifier">j</span>] = (<span class="ruby-identifier">lindex</span> * <span class="ruby-constant">HANGUL_VCOUNT</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">vindex</span>) * <span class="ruby-constant">HANGUL_TCOUNT</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tindex</span> <span class="ruby-operator">+</span> <span class="ruby-constant">HANGUL_SBASE</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">starter_pos</span> <span class="ruby-operator">+=</span> <span class="ruby-number">1</span>
      <span class="ruby-identifier">starter_char</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">starter_pos</span>]
    <span class="ruby-comment"># -- Other characters</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">current_char</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">pos</span>]
      <span class="ruby-identifier">current</span> = <span class="ruby-constant">UCD</span>[<span class="ruby-identifier">current_char</span>]
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">current</span>.<span class="ruby-identifier">combining_class</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">previous_combining_class</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">ref</span> = <span class="ruby-constant">UCD</span>.<span class="ruby-identifier">composition_map</span>[<span class="ruby-identifier">starter_char</span>]
          <span class="ruby-identifier">composition</span> = <span class="ruby-identifier">ref</span>[<span class="ruby-identifier">current_char</span>]
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">composition</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">composition</span>.<span class="ruby-identifier">nil?</span>
          <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">starter_pos</span>] = <span class="ruby-identifier">composition</span>
          <span class="ruby-identifier">starter_char</span> = <span class="ruby-identifier">composition</span>
          <span class="ruby-identifier">codepoints</span>.<span class="ruby-identifier">delete_at</span> <span class="ruby-identifier">pos</span>
          <span class="ruby-identifier">eoa</span> <span class="ruby-operator">-=</span> <span class="ruby-number">1</span>
          <span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-number">1</span>
          <span class="ruby-identifier">previous_combining_class</span> = <span class="ruby-number">-1</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">previous_combining_class</span> = <span class="ruby-identifier">current</span>.<span class="ruby-identifier">combining_class</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">previous_combining_class</span> = <span class="ruby-identifier">current</span>.<span class="ruby-identifier">combining_class</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">current</span>.<span class="ruby-identifier">combining_class</span> <span class="ruby-operator">==</span> <span class="ruby-number">0</span>
        <span class="ruby-identifier">starter_pos</span> = <span class="ruby-identifier">pos</span>
        <span class="ruby-identifier">starter_char</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">pos</span>]
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">codepoints</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-decompose_codepoints">
            
              <a name="method-c-decompose_codepoints"></a><b>decompose_codepoints</b>(type, codepoints)
            
          </div>
          
          
            <div class="description">
              <p>Decompose composed characters to the decomposed form</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-decompose_codepoints_source')" id="l_method-c-decompose_codepoints_source">show</a>
                
              </p>
              <div id="method-c-decompose_codepoints_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 371</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">decompose_codepoints</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">codepoints</span>)
  <span class="ruby-identifier">codepoints</span>.<span class="ruby-identifier">inject</span>([]) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">decomposed</span>, <span class="ruby-identifier">cp</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># if it's a hangul syllable starter character</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">HANGUL_SBASE</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">cp</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">cp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">HANGUL_SLAST</span>
      <span class="ruby-identifier">sindex</span> = <span class="ruby-identifier">cp</span> <span class="ruby-operator">-</span> <span class="ruby-constant">HANGUL_SBASE</span>
      <span class="ruby-identifier">ncp</span> = [] <span class="ruby-comment"># new codepoints</span>
      <span class="ruby-identifier">ncp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">HANGUL_LBASE</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">sindex</span> <span class="ruby-operator">/</span> <span class="ruby-constant">HANGUL_NCOUNT</span>
      <span class="ruby-identifier">ncp</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">HANGUL_VBASE</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">sindex</span> <span class="ruby-operator">%</span> <span class="ruby-constant">HANGUL_NCOUNT</span>) <span class="ruby-operator">/</span> <span class="ruby-constant">HANGUL_TCOUNT</span>
      <span class="ruby-identifier">tindex</span> = <span class="ruby-identifier">sindex</span> <span class="ruby-operator">%</span> <span class="ruby-constant">HANGUL_TCOUNT</span>
      <span class="ruby-identifier">ncp</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-constant">HANGUL_TBASE</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tindex</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">tindex</span> <span class="ruby-operator">==</span> <span class="ruby-number">0</span>
      <span class="ruby-identifier">decomposed</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">ncp</span>
    <span class="ruby-comment"># if the codepoint is decomposable in with the current decomposition type</span>
    <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">ncp</span> = <span class="ruby-constant">UCD</span>[<span class="ruby-identifier">cp</span>].<span class="ruby-identifier">decomp_mapping</span>) <span class="ruby-keyword">and</span> (<span class="ruby-operator">!</span><span class="ruby-constant">UCD</span>[<span class="ruby-identifier">cp</span>].<span class="ruby-identifier">decomp_type</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:compatability</span>)
      <span class="ruby-identifier">decomposed</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">decompose_codepoints</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">ncp</span>.<span class="ruby-identifier">dup</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">decomposed</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cp</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-g_pack">
            
              <a name="method-c-g_pack"></a><b>g_pack</b>(unpacked)
            
          </div>
          
          
            <div class="description">
              <p>Reverse operation of <a
href="UTF8Handler.html#method-c-g_unpack">::g_unpack</a></p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-g_pack_source')" id="l_method-c-g_pack_source">show</a>
                
              </p>
              <div id="method-c-g_pack_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 337</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">g_pack</span>(<span class="ruby-identifier">unpacked</span>)
  <span class="ruby-identifier">unpacked</span>.<span class="ruby-identifier">flatten</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-g_unpack">
            
              <a name="method-c-g_unpack"></a><b>g_unpack</b>(str)
            
          </div>
          
          
            <div class="description">
              <p>Unpack the string at grapheme boundaries instead of codepoint boundaries</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-g_unpack_source')" id="l_method-c-g_unpack_source">show</a>
                
              </p>
              <div id="method-c-g_unpack_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 306</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">g_unpack</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-identifier">codepoints</span> = <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-identifier">unpacked</span> = []
  <span class="ruby-identifier">pos</span> = <span class="ruby-number">0</span>
  <span class="ruby-identifier">marker</span> = <span class="ruby-number">0</span>
  <span class="ruby-identifier">eoc</span> = <span class="ruby-identifier">codepoints</span>.<span class="ruby-identifier">length</span>
  <span class="ruby-keyword">while</span>(<span class="ruby-identifier">pos</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">eoc</span>)
    <span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-number">1</span>
    <span class="ruby-identifier">previous</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">pos</span><span class="ruby-operator">-</span><span class="ruby-number">1</span>]
    <span class="ruby-identifier">current</span> = <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">pos</span>]
    <span class="ruby-keyword">if</span> (
        <span class="ruby-comment"># CR X LF</span>
        <span class="ruby-identifier">one</span> = ( <span class="ruby-identifier">previous</span> <span class="ruby-operator">==</span> <span class="ruby-constant">UCD</span>.<span class="ruby-identifier">boundary</span>[<span class="ruby-value">:cr</span>] <span class="ruby-keyword">and</span> <span class="ruby-identifier">current</span> <span class="ruby-operator">==</span> <span class="ruby-constant">UCD</span>.<span class="ruby-identifier">boundary</span>[<span class="ruby-value">:lf</span>] ) <span class="ruby-keyword">or</span>
        <span class="ruby-comment"># L X (L|V|LV|LVT)</span>
        <span class="ruby-identifier">two</span> = ( <span class="ruby-constant">UCD</span>.<span class="ruby-identifier">boundary</span>[<span class="ruby-value">:l</span>] <span class="ruby-operator">===</span> <span class="ruby-identifier">previous</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">in_char_class?</span>(<span class="ruby-identifier">current</span>, [<span class="ruby-value">:l</span>,<span class="ruby-value">:v</span>,<span class="ruby-value">:lv</span>,<span class="ruby-value">:lvt</span>]) ) <span class="ruby-keyword">or</span>
        <span class="ruby-comment"># (LV|V) X (V|T)</span>
        <span class="ruby-identifier">three</span> = ( <span class="ruby-identifier">in_char_class?</span>(<span class="ruby-identifier">previous</span>, [<span class="ruby-value">:lv</span>,<span class="ruby-value">:v</span>]) <span class="ruby-keyword">and</span> <span class="ruby-identifier">in_char_class?</span>(<span class="ruby-identifier">current</span>, [<span class="ruby-value">:v</span>,<span class="ruby-value">:t</span>]) ) <span class="ruby-keyword">or</span>
        <span class="ruby-comment"># (LVT|T) X (T)</span>
        <span class="ruby-identifier">four</span> = ( <span class="ruby-identifier">in_char_class?</span>(<span class="ruby-identifier">previous</span>, [<span class="ruby-value">:lvt</span>,<span class="ruby-value">:t</span>]) <span class="ruby-keyword">and</span> <span class="ruby-constant">UCD</span>.<span class="ruby-identifier">boundary</span>[<span class="ruby-value">:t</span>] <span class="ruby-operator">===</span> <span class="ruby-identifier">current</span> ) <span class="ruby-keyword">or</span>
        <span class="ruby-comment"># X Extend</span>
        <span class="ruby-identifier">five</span> = (<span class="ruby-constant">UCD</span>.<span class="ruby-identifier">boundary</span>[<span class="ruby-value">:extend</span>] <span class="ruby-operator">===</span> <span class="ruby-identifier">current</span>)
      )
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">unpacked</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">marker</span><span class="ruby-operator">..</span><span class="ruby-identifier">pos</span><span class="ruby-operator">-</span><span class="ruby-number">1</span>]
      <span class="ruby-identifier">marker</span> = <span class="ruby-identifier">pos</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span> 
  <span class="ruby-identifier">unpacked</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-in_char_class-3F">
            
              <a name="method-c-in_char_class-3F"></a><b>in_char_class?</b>(codepoint, classes)
            
          </div>
          
          
            <div class="description">
              <p>Detect whether the codepoint is in a certain character class. Primarily
used by the grapheme cluster support.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-in_char_class-3F_source')" id="l_method-c-in_char_class-3F_source">show</a>
                
              </p>
              <div id="method-c-in_char_class-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 292</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">in_char_class?</span>(<span class="ruby-identifier">codepoint</span>, <span class="ruby-identifier">classes</span>)
  <span class="ruby-identifier">classes</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-constant">UCD</span>.<span class="ruby-identifier">boundary</span>[<span class="ruby-identifier">c</span>] <span class="ruby-operator">===</span> <span class="ruby-identifier">codepoint</span> } <span class="ruby-operator">?</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-reorder_characters">
            
              <a name="method-c-reorder_characters"></a><b>reorder_characters</b>(codepoints)
            
          </div>
          
          
            <div class="description">
              <p>Re-order codepoints so the string becomes canonical</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-reorder_characters_source')" id="l_method-c-reorder_characters_source">show</a>
                
              </p>
              <div id="method-c-reorder_characters_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 355</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">reorder_characters</span>(<span class="ruby-identifier">codepoints</span>)
  <span class="ruby-identifier">length</span> = <span class="ruby-identifier">codepoints</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span> <span class="ruby-number">1</span>
  <span class="ruby-identifier">pos</span> = <span class="ruby-number">0</span>
  <span class="ruby-keyword">while</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">length</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">cp1</span>, <span class="ruby-identifier">cp2</span> = <span class="ruby-constant">UCD</span>[<span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">pos</span>]], <span class="ruby-constant">UCD</span>[<span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">pos</span><span class="ruby-operator">+</span><span class="ruby-number">1</span>]]
    <span class="ruby-keyword">if</span> (<span class="ruby-identifier">cp1</span>.<span class="ruby-identifier">combining_class</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cp2</span>.<span class="ruby-identifier">combining_class</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">cp2</span>.<span class="ruby-identifier">combining_class</span> <span class="ruby-operator">&gt;</span> <span class="ruby-number">0</span>)
      <span class="ruby-identifier">codepoints</span>[<span class="ruby-identifier">pos</span><span class="ruby-operator">..</span><span class="ruby-identifier">pos</span><span class="ruby-operator">+</span><span class="ruby-number">1</span>] = <span class="ruby-identifier">cp2</span>.<span class="ruby-identifier">code</span>, <span class="ruby-identifier">cp1</span>.<span class="ruby-identifier">code</span>
      <span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> (<span class="ruby-identifier">pos</span> <span class="ruby-operator">&gt;</span> <span class="ruby-number">0</span> <span class="ruby-operator">?</span> <span class="ruby-number">-1</span> <span class="ruby-operator">:</span> <span class="ruby-number">1</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">pos</span> <span class="ruby-operator">+=</span> <span class="ruby-number">1</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">codepoints</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-to_case">
            
              <a name="method-c-to_case"></a><b>to_case</b>(way, str)
            
          </div>
          
          
            <div class="description">
              <p>Convert characters to a different case</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-to_case_source')" id="l_method-c-to_case_source">show</a>
                
              </p>
              <div id="method-c-to_case_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 342</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">to_case</span>(<span class="ruby-identifier">way</span>, <span class="ruby-identifier">str</span>)
  <span class="ruby-identifier">u_unpack</span>(<span class="ruby-identifier">str</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">codepoint</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">cp</span> = <span class="ruby-constant">UCD</span>[<span class="ruby-identifier">codepoint</span>] 
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">cp</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">ncp</span> = <span class="ruby-identifier">cp</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">way</span>)
      <span class="ruby-identifier">ncp</span> <span class="ruby-operator">&gt;</span> <span class="ruby-number">0</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">ncp</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">codepoint</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">codepoint</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-string">'U*'</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-u_unpack">
            
              <a name="method-c-u_unpack"></a><b>u_unpack</b>(str)
            
          </div>
          
          
            <div class="description">
              <p>Unpack the string at codepoints boundaries</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-u_unpack_source')" id="l_method-c-u_unpack_source">show</a>
                
              </p>
              <div id="method-c-u_unpack_source" class="dyn-source">
                <pre><span class="ruby-comment"># File rails/activesupport/lib/active_support/multibyte/handlers/utf8_handler.rb, line 297</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">u_unpack</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">str</span>.<span class="ruby-identifier">unpack</span> <span class="ruby-string">'U*'</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">ArgumentError</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncodingError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">'malformed UTF-8 character'</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                        </div>
    </div>
  </body>
</html>    